---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "new_feature.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: new_feature.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dask.distributed</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
<span class="n">c</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

            <div>
                <div style="
                    width: 24px;
                    height: 24px;
                    background-color: #e1e1e1;
                    border: 3px solid #9D9D9D;
                    border-radius: 5px;
                    position: absolute;"> </div>
                <div style="margin-left: 48px;">
                    <h3 style="margin-bottom: 0px;">Client</h3>
                    <p style="color: #9D9D9D; margin-bottom: 0px;">Client-8a1cd64e-04bf-11ec-9652-acde48001122</p>
                    <table style="width: 100%; text-align: left;">
                    
                <tr>
                    <td style="text-align: left;"><strong>Connection method:</strong> Cluster object</td>
                    <td style="text-align: left;"><strong>Cluster type:</strong> LocalCluster</td>
                </tr>
                
                <tr>
                    <td style="text-align: left;">
                        <strong>Dashboard: </strong>
                        <a href="http://127.0.0.1:8787/status">http://127.0.0.1:8787/status</a>
                    </td>
                    <td style="text-align: left;"></td>
                </tr>
                
                    </table>
                    
                <details>
                <summary style="margin-bottom: 20px;"><h3 style="display: inline;">Cluster Info</h3></summary>
                
            <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output">
                <div style="
                    width: 24px;
                    height: 24px;
                    background-color: #e1e1e1;
                    border: 3px solid #9D9D9D;
                    border-radius: 5px;
                    position: absolute;"> </div>
                <div style="margin-left: 48px;">
                    <h3 style="margin-bottom: 0px; margin-top: 0px;">LocalCluster</h3>
                    <p style="color: #9D9D9D; margin-bottom: 0px;">74e92074</p>
                    <table style="width: 100%; text-align: left;">
                    
            <tr>
                <td style="text-align: left;"><strong>Status:</strong> running</td>
                <td style="text-align: left;"><strong>Using processes:</strong> True</td>
            </tr>
        
            <tr>
                <td style="text-align: left;">
                    <strong>Dashboard:</strong> <a href="http://127.0.0.1:8787/status">http://127.0.0.1:8787/status</a>
                </td>
                <td style="text-align: left;"><strong>Workers:</strong> 4</td>
            </tr>
            <tr>
                <td style="text-align: left;">
                    <strong>Total threads:</strong>
                    8
                </td>
                <td style="text-align: left;">
                    <strong>Total memory:</strong>
                    8.00 GiB
                </td>
            </tr>
        
                    </table>
                    <details>
                    <summary style="margin-bottom: 20px;"><h3 style="display: inline;">Scheduler Info</h3></summary>
                    
        <div style="">
            
            <div>
                <div style="
                    width: 24px;
                    height: 24px;
                    background-color: #FFF7E5;
                    border: 3px solid #FF6132;
                    border-radius: 5px;
                    position: absolute;"> </div>
                <div style="margin-left: 48px;">
                    <h3 style="margin-bottom: 0px;">Scheduler</h3>
                    <p style="color: #9D9D9D; margin-bottom: 0px;">Scheduler-085fa67b-c13d-4622-8b9c-cc83648db56b</p>
                    <table style="width: 100%; text-align: left;">
                        <tr>
                            <td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:52805</td>
                            <td style="text-align: left;"><strong>Workers:</strong> 4</td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">
                                <strong>Dashboard:</strong> <a href="http://127.0.0.1:8787/status">http://127.0.0.1:8787/status</a>
                            </td>
                            <td style="text-align: left;">
                                <strong>Total threads:</strong>
                                8
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">
                                <strong>Started:</strong>
                                Just now
                            </td>
                            <td style="text-align: left;">
                                <strong>Total memory:</strong>
                                8.00 GiB
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        
            <details style="margin-left: 48px;">
            <summary style="margin-bottom: 20px;"><h3 style="display: inline;">Workers</h3></summary>
            
            <div style="margin-bottom: 20px;">
                <div style="width: 24px;
                            height: 24px;
                            background-color: #DBF5FF;
                            border: 3px solid #4CC9FF;
                            border-radius: 5px;
                            position: absolute;"> </div>
                <div style="margin-left: 48px;">
                <details>
                    <summary>
                        <h4 style="margin-bottom: 0px; display: inline;">Worker: 0</h4>
                    </summary>
                    <table style="width: 100%; text-align: left;">
                        <tr>
                            <td style="text-align: left;"><strong>Comm: </strong> tcp://127.0.0.1:52815</td>
                            <td style="text-align: left;"><strong>Total threads: </strong> 2</td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">
                                <strong>Dashboard: </strong>
                                <a href="http://127.0.0.1:52819/status">http://127.0.0.1:52819/status</a>
                            </td>
                            <td style="text-align: left;">
                                <strong>Memory: </strong>
                                2.00 GiB
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>Nanny: </strong> tcp://127.0.0.1:52808</td>
                            <td style="text-align: left;"></td>
                        </tr>
                        <tr>
                            <td colspan="2" style="text-align: left;">
                                <strong>Local directory: </strong>
                                /Users/ottomorris/Documents/py_clone_detective/dask-worker-space/worker-v5x0sy5u
                            </td>
                        </tr>
                        
                        
                    </table>
                </details>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <div style="width: 24px;
                            height: 24px;
                            background-color: #DBF5FF;
                            border: 3px solid #4CC9FF;
                            border-radius: 5px;
                            position: absolute;"> </div>
                <div style="margin-left: 48px;">
                <details>
                    <summary>
                        <h4 style="margin-bottom: 0px; display: inline;">Worker: 1</h4>
                    </summary>
                    <table style="width: 100%; text-align: left;">
                        <tr>
                            <td style="text-align: left;"><strong>Comm: </strong> tcp://127.0.0.1:52811</td>
                            <td style="text-align: left;"><strong>Total threads: </strong> 2</td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">
                                <strong>Dashboard: </strong>
                                <a href="http://127.0.0.1:52812/status">http://127.0.0.1:52812/status</a>
                            </td>
                            <td style="text-align: left;">
                                <strong>Memory: </strong>
                                2.00 GiB
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>Nanny: </strong> tcp://127.0.0.1:52807</td>
                            <td style="text-align: left;"></td>
                        </tr>
                        <tr>
                            <td colspan="2" style="text-align: left;">
                                <strong>Local directory: </strong>
                                /Users/ottomorris/Documents/py_clone_detective/dask-worker-space/worker-2jb8j1gg
                            </td>
                        </tr>
                        
                        
                    </table>
                </details>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <div style="width: 24px;
                            height: 24px;
                            background-color: #DBF5FF;
                            border: 3px solid #4CC9FF;
                            border-radius: 5px;
                            position: absolute;"> </div>
                <div style="margin-left: 48px;">
                <details>
                    <summary>
                        <h4 style="margin-bottom: 0px; display: inline;">Worker: 2</h4>
                    </summary>
                    <table style="width: 100%; text-align: left;">
                        <tr>
                            <td style="text-align: left;"><strong>Comm: </strong> tcp://127.0.0.1:52818</td>
                            <td style="text-align: left;"><strong>Total threads: </strong> 2</td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">
                                <strong>Dashboard: </strong>
                                <a href="http://127.0.0.1:52821/status">http://127.0.0.1:52821/status</a>
                            </td>
                            <td style="text-align: left;">
                                <strong>Memory: </strong>
                                2.00 GiB
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>Nanny: </strong> tcp://127.0.0.1:52810</td>
                            <td style="text-align: left;"></td>
                        </tr>
                        <tr>
                            <td colspan="2" style="text-align: left;">
                                <strong>Local directory: </strong>
                                /Users/ottomorris/Documents/py_clone_detective/dask-worker-space/worker-3a4rf9vj
                            </td>
                        </tr>
                        
                        
                    </table>
                </details>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <div style="width: 24px;
                            height: 24px;
                            background-color: #DBF5FF;
                            border: 3px solid #4CC9FF;
                            border-radius: 5px;
                            position: absolute;"> </div>
                <div style="margin-left: 48px;">
                <details>
                    <summary>
                        <h4 style="margin-bottom: 0px; display: inline;">Worker: 3</h4>
                    </summary>
                    <table style="width: 100%; text-align: left;">
                        <tr>
                            <td style="text-align: left;"><strong>Comm: </strong> tcp://127.0.0.1:52814</td>
                            <td style="text-align: left;"><strong>Total threads: </strong> 2</td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">
                                <strong>Dashboard: </strong>
                                <a href="http://127.0.0.1:52816/status">http://127.0.0.1:52816/status</a>
                            </td>
                            <td style="text-align: left;">
                                <strong>Memory: </strong>
                                2.00 GiB
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: left;"><strong>Nanny: </strong> tcp://127.0.0.1:52809</td>
                            <td style="text-align: left;"></td>
                        </tr>
                        <tr>
                            <td colspan="2" style="text-align: left;">
                                <strong>Local directory: </strong>
                                /Users/ottomorris/Documents/py_clone_detective/dask-worker-space/worker-nbtd2f0u
                            </td>
                        </tr>
                        
                        
                    </table>
                </details>
                </div>
            </div>
            
            </details>
        </div>
        
                    </details>
                </div>
            </div>
        
                </details>
                
                </div>
            </div>
        
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="kn">from</span> <span class="nn">py_clone_detective.clone_counters</span> <span class="kn">import</span> <span class="n">LazyCloneCounter</span>
<span class="kn">from</span> <span class="nn">py_clone_detective.utils</span> <span class="kn">import</span> <span class="n">generate_random_cmap</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exp</span> <span class="o">=</span> <span class="n">LazyCloneCounter</span><span class="p">(</span>
    <span class="n">exp_name</span><span class="o">=</span><span class="s2">&quot;Marcm2a_E7F1&quot;</span><span class="p">,</span>
    <span class="n">img_name_regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;a\dg\d\dp\d&quot;</span><span class="p">,</span>
    <span class="n">pixel_size</span><span class="o">=</span><span class="mf">0.275</span><span class="p">,</span>
    <span class="n">tot_seg_ch</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">exp</span><span class="o">.</span><span class="n">add_images</span><span class="p">(</span>
    <span class="n">C0</span><span class="o">=</span><span class="s2">&quot;data/MARCM_experiment/images/C0/*.tif&quot;</span><span class="p">,</span>
    <span class="n">C1</span><span class="o">=</span><span class="s2">&quot;data/MARCM_experiment/images/C1/*.tif&quot;</span><span class="p">,</span>
    <span class="n">C2</span><span class="o">=</span><span class="s2">&quot;data/MARCM_experiment/images/C2/*.tif&quot;</span><span class="p">,</span>
    <span class="n">C3</span><span class="o">=</span><span class="s2">&quot;data/MARCM_experiment/images/C3/*.tif&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">exp</span><span class="o">.</span><span class="n">add_segmentations</span><span class="p">(</span><span class="n">C0</span><span class="o">=</span><span class="s2">&quot;data/MARCM_experiment/segmentations/C0_stardist_segs/*.tif&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">make_measurements</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">results_measurements</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">results_measurements</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span>
    <span class="s2">&quot;total_intensity = mean_intensity * area&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">add_clones_and_neighbouring_labels</span><span class="p">(</span>
    <span class="n">thresholds</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;int_img_ch == &quot;C1&quot; &amp; seg_ch == &quot;C0&quot; &amp; mean_intensity &gt; 1000&#39;</span><span class="p">],</span>
    <span class="n">thresh_name</span><span class="o">=</span><span class="s2">&quot;GFP&quot;</span><span class="p">,</span>
    <span class="n">calc_clones</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">add_clones_and_neighbouring_labels</span><span class="p">(</span>
    <span class="n">thresholds</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;int_img_ch == &quot;C2&quot; &amp; seg_ch == &quot;C0&quot; &amp; total_intensity &gt; 5e5&#39;</span><span class="p">,</span>
        <span class="s1">&#39;int_img_ch == &quot;C3&quot; &amp; seg_ch == &quot;C0&quot; &amp; mean_intensity &lt; 5000&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">thresh_name</span><span class="o">=</span><span class="s2">&quot;EC&quot;</span><span class="p">,</span>
    <span class="n">calc_clones</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">add_clones_and_neighbouring_labels</span><span class="p">(</span>
    <span class="n">thresholds</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;int_img_ch == &quot;C2&quot; &amp; seg_ch == &quot;C0&quot; &amp; total_intensity &lt; 5e5&#39;</span><span class="p">,</span>
        <span class="s1">&#39;int_img_ch == &quot;C3&quot; &amp; seg_ch == &quot;C0&quot; &amp; mean_intensity &gt; 5000&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">thresh_name</span><span class="o">=</span><span class="s2">&quot;EE&quot;</span><span class="p">,</span>
    <span class="n">calc_clones</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">add_clones_and_neighbouring_labels</span><span class="p">(</span>
    <span class="n">thresholds</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;not EC_pos &amp; not EE_pos &amp; area_um2 &gt; 50&quot;</span><span class="p">],</span>
    <span class="n">thresh_name</span><span class="o">=</span><span class="s2">&quot;preEC&quot;</span><span class="p">,</span>
    <span class="n">calc_clones</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">add_clones_and_neighbouring_labels</span><span class="p">(</span>
    <span class="n">thresholds</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;not EC_pos &amp; not EE_pos &amp; area_um2 &lt; 50&quot;</span><span class="p">],</span>
    <span class="n">thresh_name</span><span class="o">=</span><span class="s2">&quot;ISCorEB&quot;</span><span class="p">,</span>
    <span class="n">calc_clones</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">measure_clones_and_neighbouring_labels</span><span class="p">(</span><span class="n">thresh_name</span><span class="o">=</span><span class="s2">&quot;GFP&quot;</span><span class="p">)</span>
<span class="n">exp</span><span class="o">.</span><span class="n">measure_clones_and_neighbouring_labels</span><span class="p">(</span><span class="n">thresh_name</span><span class="o">=</span><span class="s2">&quot;EC&quot;</span><span class="p">)</span>
<span class="n">exp</span><span class="o">.</span><span class="n">measure_clones_and_neighbouring_labels</span><span class="p">(</span><span class="n">thresh_name</span><span class="o">=</span><span class="s2">&quot;EE&quot;</span><span class="p">)</span>
<span class="n">exp</span><span class="o">.</span><span class="n">measure_clones_and_neighbouring_labels</span><span class="p">(</span><span class="n">thresh_name</span><span class="o">=</span><span class="s2">&quot;preEC&quot;</span><span class="p">)</span>
<span class="n">exp</span><span class="o">.</span><span class="n">measure_clones_and_neighbouring_labels</span><span class="p">(</span><span class="n">thresh_name</span><span class="o">=</span><span class="s2">&quot;ISCorEB&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">combine_neighbour_counts_and_measurements</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">results_clones_and_neighbour_counts</span><span class="p">[</span><span class="s1">&#39;ISCorEB&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ISCorEB_neighbours</th>
      <th>ISCorEBneg_neigh_counts</th>
      <th>ISCorEBpos_neigh_counts</th>
      <th>total_neighbour_counts</th>
    </tr>
    <tr>
      <th>int_img</th>
      <th>label</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">a1g01p1</th>
      <th>11</th>
      <td>3</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>12</th>
      <td>3</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>18</th>
      <td>1</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">a2g13p3</th>
      <th>280</th>
      <td>2</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>281</th>
      <td>2</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>283</th>
      <td>2</td>
      <td>3</td>
      <td>5</td>
    </tr>
    <tr>
      <th>285</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>286</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
<p>18467 rows × 3 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nc_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;int_img_ch == &quot;C0&quot;&#39;</span><span class="p">)</span>
<span class="n">nc_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;neigh_counts|neighbour_counts&#39;</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">nc_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

<span class="n">nc_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;int_img&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s2">&quot;GFP_clone&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">nc_df</span> <span class="o">=</span> <span class="n">nc_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;pos|total_nc&#39;</span><span class="p">)</span>
<span class="n">nc_df</span> <span class="o">=</span> <span class="n">nc_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">nc_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;GFP&#39;</span><span class="p">))</span>
<span class="n">nc_df</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nc_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;pos$&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">nc_df</span> <span class="o">=</span> <span class="n">nc_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">nc_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;pos$&#39;</span><span class="p">))</span>
<span class="n">nc_df</span><span class="p">[</span><span class="s1">&#39;genotype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nc_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[</span><span class="s2">&quot;int_img&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;a1&quot;</span><span class="p">),</span> <span class="s2">&quot;ctrl&quot;</span><span class="p">,</span> <span class="s2">&quot;mut&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nc_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;total_nc != ECpos_nc + EEpos_nc + preECpos_nc + ISCorEBpos_nc&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>total_nc</th>
      <th>ECpos_nc</th>
      <th>EEpos_nc</th>
      <th>preECpos_nc</th>
      <th>ISCorEBpos_nc</th>
      <th>cell_type</th>
      <th>genotype</th>
    </tr>
    <tr>
      <th>int_img</th>
      <th>label</th>
      <th>GFP_clone</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">a1g02p3</th>
      <th>9</th>
      <th>0</th>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>2</td>
      <td>EE_pos</td>
      <td>ctrl</td>
    </tr>
    <tr>
      <th>10</th>
      <th>0</th>
      <td>3</td>
      <td>0</td>
      <td>1</td>
      <td>NaN</td>
      <td>2</td>
      <td>ISCorEB_pos</td>
      <td>ctrl</td>
    </tr>
    <tr>
      <th>12</th>
      <th>0</th>
      <td>6</td>
      <td>2</td>
      <td>1</td>
      <td>NaN</td>
      <td>3</td>
      <td>ISCorEB_pos</td>
      <td>ctrl</td>
    </tr>
    <tr>
      <th>13</th>
      <th>0</th>
      <td>4</td>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>3</td>
      <td>EC_pos</td>
      <td>ctrl</td>
    </tr>
    <tr>
      <th>14</th>
      <th>0</th>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>2</td>
      <td>ISCorEB_pos</td>
      <td>ctrl</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">a2g11p1</th>
      <th>348</th>
      <th>0</th>
      <td>3</td>
      <td>0</td>
      <td>1</td>
      <td>NaN</td>
      <td>2</td>
      <td>EC_pos</td>
      <td>mut</td>
    </tr>
    <tr>
      <th>349</th>
      <th>0</th>
      <td>4</td>
      <td>2</td>
      <td>0</td>
      <td>NaN</td>
      <td>2</td>
      <td>EC_pos</td>
      <td>mut</td>
    </tr>
    <tr>
      <th>350</th>
      <th>0</th>
      <td>4</td>
      <td>3</td>
      <td>0</td>
      <td>NaN</td>
      <td>1</td>
      <td>EC_pos</td>
      <td>mut</td>
    </tr>
    <tr>
      <th>351</th>
      <th>0</th>
      <td>4</td>
      <td>2</td>
      <td>1</td>
      <td>NaN</td>
      <td>1</td>
      <td>ISCorEB_pos</td>
      <td>mut</td>
    </tr>
    <tr>
      <th>353</th>
      <th>0</th>
      <td>3</td>
      <td>2</td>
      <td>0</td>
      <td>NaN</td>
      <td>1</td>
      <td>EC_pos</td>
      <td>mut</td>
    </tr>
  </tbody>
</table>
<p>4858 rows × 7 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

